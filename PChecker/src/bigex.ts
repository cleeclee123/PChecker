import * as PChecker from "./checker/PChecker.js";
import { PCheckerOptions } from "./checker/types.js";
import { MyConcurrentPromiseQueue } from "mypqueue";
import os from "os";

os.freemem();

console.time();

async function test() {
  const list = [
    ["68.183.185.62", "80"],
    ["202.40.177.69", "80"],
    ["64.225.4.63", "9993"],
    ["87.237.239.95", "3128"],
    ["47.253.214.60", "57114"],
    ["103.69.108.78", "8191"],
    ["187.217.54.84", "80"],
    ["45.79.17.203", "80"],
    ["8.208.84.236", "8013"],
    ["47.253.71.33", "1234"],
    ["197.255.125.12", "80"],
    ["119.13.103.211", "20201"],
    ["150.129.80.80", "8877"],
    ["146.83.128.23", "80"],
    ["61.111.38.5", "80"],
    ["20.111.54.16", "80"],
    ["20.210.113.32", "80"],
    ["20.206.106.192", "80"],
    ["43.255.113.232", "8084"],
    ["20.24.43.214", "80"],
    ["104.45.128.122", "80"],
    ["185.15.172.212", "3128"],
    ["46.171.75.186", "80"],
    ["8.213.129.15", "8080"],
    ["178.169.139.180", "8080"],
    ["142.93.219.22", "8080"],
    ["216.137.184.253", "80"],
    ["51.159.0.236", "3128"],
    ["103.184.50.60", "8082"],
    ["115.76.195.119", "11166"],
    ["216.158.236.30", "80"],
    ["125.166.59.91", "80"],
    ["45.118.139.196", "80"],
    ["189.113.14.243", "80"],
    ["93.99.211.233", "8080"],
    ["185.125.169.24", "8118"],
    ["66.70.178.214", "9300"],
    ["158.69.53.98", "9300"],
    ["103.78.97.38", "8080"],
    ["216.169.73.65", "34679"],
    ["103.211.26.222", "8181"],
    ["177.66.101.223", "8024"],
    ["64.225.8.142", "9990"],
    ["217.66.200.154", "3128"],
    ["89.208.105.195", "4555"],
    ["91.121.106.55", "4444"],
    ["66.188.181.143", "8080"],
    ["8.209.68.1", "8080"],
    ["8.209.64.208", "8080"],
    ["173.82.140.16", "80"],
    ["46.105.35.193", "8080"],
    ["47.254.158.115", "2020"],
    ["87.248.171.0", "49650"],
    ["207.180.216.251", "8118"],
    ["115.144.102.39", "10080"],
    ["191.101.234.75", "80"],
    ["40.83.102.86", "80"],
    ["78.28.152.111", "80"],
    ["72.170.220.17", "8080"],
    ["27.54.96.11", "18081"],
    ["200.105.215.22", "33630"],
    ["192.236.160.186", "80"],
    ["65.2.144.179", "80"],
    ["103.195.245.234", "80"],
    ["34.146.64.228", "3128"],
    ["64.225.4.12", "9991"],
    ["208.109.32.60", "81"],
    ["80.232.242.125", "9002"],
    ["171.251.245.38", "10003"],
    ["171.250.87.225", "10003"],
    ["212.182.90.118", "80"],
    ["64.225.8.82", "9995"],
    ["137.184.197.190", "80"],
    ["203.146.127.159", "80"],
    ["178.33.3.163", "8080"],
    ["64.225.8.179", "9994"],
    ["158.69.73.79", "9300"],
    ["45.74.86.150", "8080"],
    ["170.187.186.194", "8080"],
    ["58.27.59.249", "80"],
    ["88.99.201.170", "80"],
    ["155.94.178.6", "8080"],
    ["61.16.138.238", "8080"],
    ["158.69.71.245", "9300"],
    ["205.213.80.8", "8009"],
    ["207.180.250.238", "80"],
    ["144.217.253.209", "9300"],
    ["102.223.20.217", "80"],
    ["68.183.143.134", "80"],
    ["46.47.197.210", "3128"],
    ["167.99.174.59", "80"],
    ["103.141.142.102", "41367"],
    ["34.98.65.22", "5222"],
    ["190.183.60.253", "8060"],
    ["64.225.4.81", "9998"],
    ["64.225.8.135", "9991"],
    ["182.72.203.243", "80"],
    ["64.225.8.121", "9993"],
    ["64.225.8.191", "9994"],
    ["64.225.8.132", "9996"],
    ["178.210.51.118", "8080"],
    ["103.55.33.59", "8080"],
    ["52.66.251.90", "80"],
    ["193.122.197.154", "80"],
    ["151.80.136.138", "3128"],
    ["172.104.41.13", "16379"],
    ["139.59.59.122", "8118"],
    ["103.252.163.191", "80"],
    ["188.166.56.246", "80"],
    ["95.85.24.83", "8118"],
    ["47.74.71.208", "2080"],
    ["66.85.30.138", "80"],
    ["198.11.175.192", "8499"],
    ["41.204.63.118", "80"],
    ["105.16.115.202", "80"],
    ["159.203.13.121", "80"],
    ["167.172.158.85", "81"],
    ["201.217.49.2", "80"],
    ["115.144.101.201", "10001"],
    ["213.230.127.93", "3128"],
    ["103.92.26.190", "4002"],
    ["129.151.160.199", "80"],
    ["202.61.204.51", "80"],
    ["47.243.175.55", "9091"],
    ["46.246.12.5", "8118"],
    ["5.2.75.58", "8118"],
    ["27.147.174.107", "8080"],
    ["103.84.159.8", "80"],
    ["43.243.142.60", "59916"],
    ["102.130.133.102", "53281"],
    ["83.222.6.82", "3128"],
    ["45.15.16.174", "8118"],
    ["85.50.139.97", "55443"],
    ["186.137.169.148", "8080"],
    ["52.56.89.12", "80"],
    ["196.20.125.149", "8083"],
    ["167.99.116.111", "8001"],
    ["51.79.50.31", "9300"],
    ["103.155.217.156", "41483"],
    ["187.44.167.78", "60786"],
    ["54.39.132.131", "80"],
    ["191.101.1.116", "80"],
    ["103.92.233.40", "80"],
    ["64.225.8.115", "9996"],
    ["103.141.143.102", "41516"],
    ["158.160.56.149", "8080"],
    ["216.87.32.233", "80"],
    ["45.234.61.7", "999"],
    ["68.183.230.116", "36787"],
    ["165.227.81.188", "9958"],
    ["185.74.7.50", "3128"],
    ["103.168.53.53", "41367"],
    ["64.225.4.63", "9993"],
    ["68.183.185.62", "80"],
    ["87.237.239.95", "3128"],
    ["202.40.177.69", "80"],
    ["185.15.172.212", "3128"],
    ["150.129.80.80", "8877"],
    ["47.253.214.60", "57114"],
    ["119.13.103.211", "20201"],
    ["8.208.84.236", "8013"],
    ["103.69.108.78", "8191"],
    ["178.169.139.180", "8080"],
    ["8.213.129.15", "8080"],
    ["51.159.0.236", "3128"],
    ["142.93.219.22", "8080"],
    ["115.76.195.119", "11166"],
    ["103.184.50.60", "8082"],
    ["185.125.169.24", "8118"],
    ["66.70.178.214", "9300"],
    ["64.225.8.142", "9990"],
    ["216.169.73.65", "34679"],
    ["103.78.97.38", "8080"],
    ["158.69.53.98", "9300"],
    ["177.66.101.223", "8024"],
    ["217.66.200.154", "3128"],
    ["89.208.105.195", "4555"],
    ["103.211.26.222", "8181"],
    ["66.188.181.143", "8080"],
    ["91.121.106.55", "4444"],
    ["207.180.216.251", "8118"],
    ["115.144.102.39", "10080"],
    ["40.83.102.86", "80"],
    ["64.225.8.191", "9994"],
    ["88.99.201.170", "80"],
    ["64.225.8.179", "9994"],
    ["64.225.8.121", "9993"],
    ["64.225.8.132", "9996"],
    ["64.225.4.12", "9991"],
    ["34.98.65.22", "5222"],
    ["171.251.245.38", "10003"],
    ["158.69.73.79", "9300"],
    ["170.187.186.194", "8080"],
    ["158.69.71.245", "9300"],
    ["64.225.8.135", "9991"],
    ["178.33.3.163", "8080"],
    ["144.217.253.209", "9300"],
    ["205.213.80.8", "8009"],
    ["61.16.138.238", "8080"],
    ["64.225.4.81", "9998"],
    ["64.225.8.82", "9995"],
    ["200.105.215.22", "33630"],
    ["27.54.96.11", "18081"],
    ["171.250.87.225", "10003"],
    ["151.80.136.138", "3128"],
    ["103.55.33.59", "8080"],
    ["52.66.251.90", "80"],
    ["178.210.51.118", "8080"],
    ["193.122.197.154", "80"],
    ["172.104.41.13", "16379"],
    ["95.85.24.83", "8118"],
    ["139.59.59.122", "8118"],
    ["66.85.30.138", "80"],
    ["213.230.127.93", "3128"],
    ["115.144.101.201", "10001"],
    ["5.2.75.58", "8118"],
    ["27.147.174.107", "8080"],
    ["103.84.159.8", "80"],
    ["83.222.6.82", "3128"],
    ["102.130.133.102", "53281"],
    ["85.50.139.97", "55443"],
    ["186.137.169.148", "8080"],
    ["52.56.89.12", "80"],
    ["45.15.16.174", "8118"],
    ["167.99.116.111", "8001"],
    ["158.160.56.149", "8080"],
    ["64.225.8.115", "9996"],
    ["185.74.7.50", "3128"],
    ["51.79.50.31", "9300"],
    ["165.227.81.188", "9958"],
    ["158.69.71.69", "9300"],
    ["51.79.50.46", "9300"],
    ["129.159.88.228", "80"],
    ["68.183.185.62", "80"],
    ["202.40.177.69", "80"],
    ["64.225.4.63", "9993"],
    ["87.237.239.95", "3128"],
    ["47.253.214.60", "57114"],
    ["103.69.108.78", "8191"],
    ["187.217.54.84", "80"],
    ["45.79.17.203", "80"],
    ["8.208.84.236", "8013"],
    ["47.253.71.33", "1234"],
    ["197.255.125.12", "80"],
    ["119.13.103.211", "20201"],
    ["150.129.80.80", "8877"],
    ["146.83.128.23", "80"],
    ["61.111.38.5", "80"],
    ["20.111.54.16", "80"],
    ["20.210.113.32", "80"],
    ["20.206.106.192", "80"],
    ["43.255.113.232", "8084"],
    ["20.24.43.214", "80"],
    ["104.45.128.122", "80"],
    ["185.15.172.212", "3128"],
    ["46.171.75.186", "80"],
    ["8.213.129.15", "8080"],
    ["178.169.139.180", "8080"],
    ["142.93.219.22", "8080"],
    ["216.137.184.253", "80"],
    ["51.159.0.236", "3128"],
    ["103.184.50.60", "8082"],
    ["115.76.195.119", "11166"],
    ["216.158.236.30", "80"],
    ["125.166.59.91", "80"],
    ["45.118.139.196", "80"],
    ["189.113.14.243", "80"],
    ["93.99.211.233", "8080"],
    ["185.125.169.24", "8118"],
    ["66.70.178.214", "9300"],
    ["158.69.53.98", "9300"],
    ["103.78.97.38", "8080"],
    ["216.169.73.65", "34679"],
    ["103.211.26.222", "8181"],
    ["177.66.101.223", "8024"],
    ["64.225.8.142", "9990"],
    ["217.66.200.154", "3128"],
    ["89.208.105.195", "4555"],
    ["91.121.106.55", "4444"],
    ["66.188.181.143", "8080"],
    ["8.209.68.1", "8080"],
    ["8.209.64.208", "8080"],
    ["173.82.140.16", "80"],
    ["46.105.35.193", "8080"],
    ["47.254.158.115", "2020"],
    ["87.248.171.0", "49650"],
    ["207.180.216.251", "8118"],
    ["115.144.102.39", "10080"],
    ["191.101.234.75", "80"],
    ["40.83.102.86", "80"],
    ["78.28.152.111", "80"],
    ["72.170.220.17", "8080"],
    ["27.54.96.11", "18081"],
    ["200.105.215.22", "33630"],
    ["192.236.160.186", "80"],
    ["65.2.144.179", "80"],
    ["103.195.245.234", "80"],
    ["34.146.64.228", "3128"],
    ["64.225.4.12", "9991"],
    ["208.109.32.60", "81"],
    ["80.232.242.125", "9002"],
    ["171.251.245.38", "10003"],
    ["171.250.87.225", "10003"],
    ["212.182.90.118", "80"],
    ["64.225.8.82", "9995"],
    ["137.184.197.190", "80"],
    ["203.146.127.159", "80"],
    ["178.33.3.163", "8080"],
    ["64.225.8.179", "9994"],
    ["158.69.73.79", "9300"],
    ["45.74.86.150", "8080"],
    ["170.187.186.194", "8080"],
    ["58.27.59.249", "80"],
    ["88.99.201.170", "80"],
    ["155.94.178.6", "8080"],
    ["61.16.138.238", "8080"],
    ["158.69.71.245", "9300"],
    ["205.213.80.8", "8009"],
    ["207.180.250.238", "80"],
    ["144.217.253.209", "9300"],
    ["102.223.20.217", "80"],
    ["68.183.143.134", "80"],
    ["46.47.197.210", "3128"],
    ["167.99.174.59", "80"],
    ["103.141.142.102", "41367"],
    ["34.98.65.22", "5222"],
    ["190.183.60.253", "8060"],
    ["64.225.4.81", "9998"],
    ["64.225.8.135", "9991"],
    ["182.72.203.243", "80"],
    ["64.225.8.121", "9993"],
    ["64.225.8.191", "9994"],
    ["64.225.8.132", "9996"],
    ["178.210.51.118", "8080"],
    ["103.55.33.59", "8080"],
    ["52.66.251.90", "80"],
    ["193.122.197.154", "80"],
    ["151.80.136.138", "3128"],
    ["172.104.41.13", "16379"],
    ["139.59.59.122", "8118"],
    ["103.252.163.191", "80"],
    ["188.166.56.246", "80"],
    ["95.85.24.83", "8118"],
    ["47.74.71.208", "2080"],
    ["66.85.30.138", "80"],
    ["198.11.175.192", "8499"],
    ["41.204.63.118", "80"],
    ["105.16.115.202", "80"],
    ["159.203.13.121", "80"],
    ["167.172.158.85", "81"],
    ["201.217.49.2", "80"],
    ["115.144.101.201", "10001"],
    ["213.230.127.93", "3128"],
    ["103.92.26.190", "4002"],
    ["129.151.160.199", "80"],
    ["202.61.204.51", "80"],
    ["47.243.175.55", "9091"],
    ["46.246.12.5", "8118"],
    ["5.2.75.58", "8118"],
    ["27.147.174.107", "8080"],
    ["103.84.159.8", "80"],
    ["43.243.142.60", "59916"],
    ["102.130.133.102", "53281"],
    ["83.222.6.82", "3128"],
    ["45.15.16.174", "8118"],
    ["85.50.139.97", "55443"],
    ["186.137.169.148", "8080"],
    ["52.56.89.12", "80"],
    ["196.20.125.149", "8083"],
    ["167.99.116.111", "8001"],
    ["51.79.50.31", "9300"],
    ["103.155.217.156", "41483"],
    ["187.44.167.78", "60786"],
    ["54.39.132.131", "80"],
    ["191.101.1.116", "80"],
    ["103.92.233.40", "80"],
    ["64.225.8.115", "9996"],
    ["103.141.143.102", "41516"],
    ["158.160.56.149", "8080"],
    ["216.87.32.233", "80"],
    ["45.234.61.7", "999"],
    ["68.183.230.116", "36787"],
    ["165.227.81.188", "9958"],
    ["185.74.7.50", "3128"],
    ["103.168.53.53", "41367"],
    ["64.225.4.63", "9993"],
    ["68.183.185.62", "80"],
    ["87.237.239.95", "3128"],
    ["202.40.177.69", "80"],
    ["185.15.172.212", "3128"],
    ["150.129.80.80", "8877"],
    ["47.253.214.60", "57114"],
    ["119.13.103.211", "20201"],
    ["8.208.84.236", "8013"],
    ["103.69.108.78", "8191"],
    ["178.169.139.180", "8080"],
    ["8.213.129.15", "8080"],
    ["51.159.0.236", "3128"],
    ["142.93.219.22", "8080"],
    ["115.76.195.119", "11166"],
    ["103.184.50.60", "8082"],
    ["185.125.169.24", "8118"],
    ["66.70.178.214", "9300"],
    ["64.225.8.142", "9990"],
    ["216.169.73.65", "34679"],
    ["103.78.97.38", "8080"],
    ["158.69.53.98", "9300"],
    ["177.66.101.223", "8024"],
    ["217.66.200.154", "3128"],
    ["89.208.105.195", "4555"],
    ["103.211.26.222", "8181"],
    ["66.188.181.143", "8080"],
    ["91.121.106.55", "4444"],
    ["207.180.216.251", "8118"],
    ["115.144.102.39", "10080"],
    ["40.83.102.86", "80"],
    ["64.225.8.191", "9994"],
    ["88.99.201.170", "80"],
    ["64.225.8.179", "9994"],
    ["64.225.8.121", "9993"],
    ["64.225.8.132", "9996"],
    ["64.225.4.12", "9991"],
    ["34.98.65.22", "5222"],
    ["171.251.245.38", "10003"],
    ["158.69.73.79", "9300"],
    ["170.187.186.194", "8080"],
    ["158.69.71.245", "9300"],
    ["64.225.8.135", "9991"],
    ["178.33.3.163", "8080"],
    ["144.217.253.209", "9300"],
    ["205.213.80.8", "8009"],
    ["61.16.138.238", "8080"],
    ["64.225.4.81", "9998"],
    ["64.225.8.82", "9995"],
    ["200.105.215.22", "33630"],
    ["27.54.96.11", "18081"],
    ["171.250.87.225", "10003"],
    ["151.80.136.138", "3128"],
    ["103.55.33.59", "8080"],
    ["52.66.251.90", "80"],
    ["178.210.51.118", "8080"],
    ["193.122.197.154", "80"],
    ["172.104.41.13", "16379"],
    ["95.85.24.83", "8118"],
    ["139.59.59.122", "8118"],
    ["66.85.30.138", "80"],
    ["213.230.127.93", "3128"],
    ["115.144.101.201", "10001"],
    ["5.2.75.58", "8118"],
    ["27.147.174.107", "8080"],
    ["103.84.159.8", "80"],
    ["83.222.6.82", "3128"],
    ["102.130.133.102", "53281"],
    ["85.50.139.97", "55443"],
    ["186.137.169.148", "8080"],
    ["52.56.89.12", "80"],
    ["45.15.16.174", "8118"],
    ["167.99.116.111", "8001"],
    ["158.160.56.149", "8080"],
    ["64.225.8.115", "9996"],
    ["185.74.7.50", "3128"],
    ["51.79.50.31", "9300"],
    ["165.227.81.188", "9958"],
    ["158.69.71.69", "9300"],
    ["51.79.50.46", "9300"],
    ["129.159.88.228", "80"],
  ];

  const queue = new MyConcurrentPromiseQueue({
    maxNumberOfConcurrentPromises: 25,
  });

  const promises = [];
  for (let i = 0; i < list.length; i++) {
    let pOptions = {
      host: list[i][0],
      port: list[i][1],
      timeout: "5000",
    } as PCheckerOptions;
    let p = new PChecker.PChecker(pOptions);
    p.setPublicIP("73.110.181.186");
    promises.push(queue.addPromise(() => p.checkEssential()));
  }

  return await Promise.all(promises).then((res) => console.log(res));
}

await test();

// mb used
let used = process.memoryUsage().heapUsed / 1024 / 1024;
console.log(used);

console.timeEnd();

process.kill(process.pid);
